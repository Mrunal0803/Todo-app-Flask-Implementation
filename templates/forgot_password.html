{% extends 'base.html' %}
{% block title %}Forgot Password{% endblock %}
{% block content %}
<section class="auth-card">
	<h1>Reset your password</h1>
	<form id="forgot-form" method="POST" action="{{ url_for('forgot_password') }}" novalidate>
		<div class="form-row">
			<label for="user_id">User ID</label>
			<input type="text" id="user_id" name="user_id" required />
		</div>
		<div class="form-row">
			<label for="email">Email</label>
			<input type="email" id="email" name="email" required />
		</div>
		<div class="form-row password-field">
			<label for="new_password">New Password</label>
			<div class="password-input-wrapper">
				<input type="password" id="new_password" name="new_password" required minlength="6" />
				<button type="button" class="btn password-toggle" data-target="new_password">
					<span class="eye-icon">ğŸ‘ï¸</span>
				</button>
			</div>
		</div>
		<div class="form-row password-field">
			<label for="confirm_password">Retype New Password</label>
			<div class="password-input-wrapper">
				<input type="password" id="confirm_password" name="confirm_password" required minlength="6" />
				<button type="button" class="btn password-toggle" data-target="confirm_password">
					<span class="eye-icon">ğŸ‘ï¸</span>
				</button>
			</div>
		</div>
		<div class="form-actions">
			<button type="submit" class="btn primary">Update Password</button>
			<a class="btn link" href="{{ url_for('login') }}">Back to login</a>
		</div>
	</form>
</section>
{% endblock %}
{% block scripts %}
<script>
	document.getElementById('forgot-form').addEventListener('submit', function (e) {
		const userId = document.getElementById('user_id').value.trim();
		const email = document.getElementById('email').value.trim();
		const p1 = document.getElementById('new_password').value;
		const p2 = document.getElementById('confirm_password').value;
		if (!userId || !email || !p1 || !p2) {
			e.preventDefault();
			alert('Please fill out all fields.');
			return;
		}
		if (p1.length < 6) {
			e.preventDefault();
			alert('Password must be at least 6 characters.');
			return;
		}
		if (p1 !== p2) {
			e.preventDefault();
			alert('Passwords do not match.');
		}
	});

	// Password visibility toggles
	document.querySelectorAll('.password-toggle').forEach(button => {
		button.addEventListener('click', function() {
			const targetId = this.dataset.target;
			const input = document.getElementById(targetId);
			if (!input) return;
			const type = input.type === 'password' ? 'text' : 'password';
			input.type = type;
			const icon = this.querySelector('.eye-icon');
			if (icon) icon.textContent = type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ”’';
		});
	});
</script>
{% endblock %}
